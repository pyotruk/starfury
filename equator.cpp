#include "equator.h"
/////////////////////////////////////////////////////////////////////////////////////
Equator::Equator(QSettings *settings) :
    _settings(settings),
    _artifacts(new ArtifactVector),
    _stars(new ArtifactVector),
    _mutex(new QMutex)
{
    this->moveToThread(this);
    this->start(QThread::NormalPriority);
}
/////////////////////////////////////////////////////////////////////////////////////
Equator::~Equator()
{
    this->quit();
    if(!this->wait(_termTimeout))   this->terminate();
    delete _mutex;
    delete _stars;
    delete _artifacts;
}
/////////////////////////////////////////////////////////////////////////////////////
void Equator::inputArtifacts(ArtifactVector *a,
                             QMutex *m,
                             QDateTime *t)
{
    if(m->tryLock(_timeout))
    {
        if(this->_mutex->tryLock(_timeout))
        {
            _tArts = *t;
            _artifacts->resize(a->size());
            qCopy(a->begin(), a->end(), _artifacts->begin());
            this->_mutex->unlock();
        }
        m->unlock();
    }
}
/////////////////////////////////////////////////////////////////////////////////////
void Equator::inputStars(ArtifactVector *s,
                         QMutex *m,
                         QDateTime *t)
{
    if(m->tryLock(_timeout))
    {
        if(this->_mutex->tryLock(_timeout))
        {
            _tStars = *t;
            _stars->resize(s->size());
            qCopy(s->begin(), s->end(), _stars->begin());
            this->_mutex->unlock();

            emit toGui(_artifacts, _stars, _mutex);
        }
        m->unlock();
    }
}
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
