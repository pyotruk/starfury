#include "starcatscreen.h"
/////////////////////////////////////////////////////////////////////////////////////
StarcatScreen::StarcatScreen(QSettings *settings) :
    _settings(settings),
    _tvector(new TelescopeVector),
    _starcatReader(new StarcatReader(_settings))
{
    this->moveToThread(this);
    qDebug() << "starcatScreen::_starcatReader thread: " << _starcatReader->thread();
    this->start(QThread::NormalPriority);
}
/////////////////////////////////////////////////////////////////////////////////////
StarcatScreen::~StarcatScreen()
{
    this->quit();
    this->terminate();
    delete _starcatReader;
    delete _tvector;
}
/////////////////////////////////////////////////////////////////////////////////////
void StarcatScreen::telescopeVectorIn(TelescopeVector *tvector,
                                QMutex *mutex)
{
    if(mutex->tryLock(_timeout))
    {
        *_tvector = *tvector;
        mutex->unlock();
        _starcatReader->refresh(_tvector->alpha, _tvector->delta);
        this->processing();
    }
}
/////////////////////////////////////////////////////////////////////////////////////
void StarcatScreen::processing()
{
    //ololo
}
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
