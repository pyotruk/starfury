#ifndef SNUDPSRV_H
#define SNUDPSRV_H
/////////////////////////////////////////////////////////////////////////////////////
#include <QtGlobal>
#include <QtNetwork/QUdpSocket>
#include <QSettings>
#include <QObject>
#include <QReadWriteLock>
#include <QDebug>
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
#define SKEY_UDPSERVER_PORT "/UdpServer/Port"
#define TVA_UDPPACK_ID      0x44C5EB64038F4462 //8bytes
/////////////////////////////////////////////////////////////////////////////////////
struct TelescopeVector
{
    qint64 packID;
    qint64 timeUTC;
    double azAxis;
    double elAxis;
    double azVelAxis;
    double elVelAxis;
    double azOrient;
    double elOrient;
    double azHoriz;
    double elHoriz;
    double alpha;
    double delta;
    double LST;
    double latitude;
    double fieldWidth;
    double fieldHeight;
};
////////////////////////////////////////////////////////////////////////////////////
class SnUdpSrv : public QObject
{
    Q_OBJECT
public:
    explicit SnUdpSrv(QSettings*);
    ~SnUdpSrv();
private:
    static const quint16 _defaultPort = 4444;
    static const int  _timeout = 20;
    QSettings       *_settings;
    TelescopeVector  _telescope;
    QReadWriteLock   _lock;
    quint16          _port;
    QUdpSocket       _socket;
    void loadSettings(QSettings*);
    void saveSettings(QSettings*);
private slots:
    void read();
signals:
    void telescopeVectorReady(TelescopeVector*, QReadWriteLock*);
};
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
#endif // SNUDPSRV_H
