#include "logfile.h"
/////////////////////////////////////////////////////////////////////////////////////
LogFile::LogFile(const QString &nameMask) //name format: time + nameMask + .log
{
    this->setName(nameMask);
    if(!_file.open(QIODevice::WriteOnly))
    {
        qDebug() << "file open error: "
                 << qPrintable(_file.errorString());
        return;
    }
    _stream = new QTextStream(&_file);
}
/////////////////////////////////////////////////////////////////////////////////////
LogFile::~LogFile()
{
    delete _stream;
    _file.close();
}
/////////////////////////////////////////////////////////////////////////////////////
void LogFile::setName(const QString &nameMask)
{
    QDir dir(QDir::rootPath() + nameMask + "-logs");
    if(!dir.exists())
    {
        if(!dir.mkpath(dir.absolutePath()))
        {
            qDebug() << dir.absolutePath() << "    dir creating error";
            return;
        }
    }
    QDateTime t = QDateTime::currentDateTime();
    QString fileName(t.toString("yyyy-MM-dd_hhmmss") +
                     "_" + nameMask + ".log");
    _file.setFileName(dir.absolutePath()+ "/" + fileName);
}
/////////////////////////////////////////////////////////////////////////////////////
void LogFile::write(const QString &s)
{
    *_stream << timeutils::msecFromDayBegin() << " " + s << endl;
}
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
