#include "strobgeometry.h"
/////////////////////////////////////////////////////////////////////////////////////
StrobGeometry::StrobGeometry(QSettings *s) :
    _settings(s)
{
    this->loadSettings(_settings);
    this->setCenter(_refPoint);
}
/////////////////////////////////////////////////////////////////////////////////////
StrobGeometry::~StrobGeometry()
{
    this->saveSettings(_settings);
}
/////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::loadSettings(QSettings *s)
{
    this->setSide(s->value(__skeyStrobSide, _defaultInnerSide).toInt());
    this->setRefPoint(QPoint(s->value(__skeyStrobRefPointX, _defaultRefPointX).toInt(),
                             s->value(__skeyStrobRefPointY, _defaultRefPointY).toInt()));
}
///////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::saveSettings(QSettings *s)
{
    s->setValue(__skeyStrobSide, _signal.width());
    s->setValue(__skeyStrobRefPointX, _refPoint.x());
    s->setValue(__skeyStrobRefPointY, _refPoint.y());
}
///////////////////////////////////////////////////////////////////////////////////////
const QPoint& StrobGeometry::center()
{
    _cache_Center = _signal.center();
    return _cache_Center;
}
///////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::setSide(const int side)
{
    _signal.setSize(QSize(side, side));
    this->refreshFoneRect();
}
/////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::setCenter(const QPoint &center)
{
    _signal.moveCenter(center);
    this->refreshFoneRect();
}
/////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::setCenter(const int x,
                              const int y)
{
    this->setCenter(QPoint(x, y));
}
/////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::setRefPoint(const QPoint &refPoint)
{
    _refPoint = refPoint;
}
/////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::setRect(const QRect &r)
{
    _signal = r;
    this->refreshFoneRect();
}
/////////////////////////////////////////////////////////////////////////////////////
bool StrobGeometry::checkRange(const QSize &frameSize)
{
    QRect frameRect(QPoint(0, 0), frameSize);
    if(frameRect.contains(_signal, true))
    {
        if(frameRect.contains(_fone, true))
        {
            return true;
        }
    }
    return false;
}
/////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::setVelocity(const QPointF &v)
{
    _velocity = QVector2D(v);
    _velocity.normalize();
    this->refreshFoneRect();
}
/////////////////////////////////////////////////////////////////////////////////////
void StrobGeometry::refreshFoneRect()
{
    int r = _signal.width();
    _fone.moveCenter(QPoint((int)(_signal.center().x() + r * _velocity.x()),
                            (int)(_signal.center().y() + r * _velocity.y())));
    _fone.setSize(_signal.size());
}
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
